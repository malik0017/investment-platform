<!-- backend/templates/projects/admin_task_form.html -->
{% extends "admin_base.html" %}

{% block title %}{% if task %}Edit{% else %}Create{% endif %} Task - Dashboard{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>{% if task %}Edit{% else %}Create New{% endif %} Task for {{ project.title }}</h2>
                <a href="{{ url_for('admin_project_detail', project_id=project.id) }}"
                    class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Back to Project
                </a>
            </div>

            <div class="card shadow-sm">
                <div class="card-body">
                    <form method="POST"
                        action="{% if task %}{{ url_for('admin_project_task_edit', project_id=project.id, task_id=task.id) }}{% else %}{{ url_for('admin_project_task_create', project_id=project.id) }}{% endif %}">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="title" class="form-label">Task Title *</label>
                                    <input type="text" class="form-control" id="title" name="title"
                                        value="{{ task.title if task else '' }}" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="priority" class="form-label">Priority</label>
                                    <select class="form-select" id="priority" name="priority">
                                        <option value="Medium" {% if task and task.priority=='Medium' %}selected{% endif
                                            %}>Medium</option>
                                        <option value="Low" {% if task and task.priority=='Low' %}selected{% endif %}>
                                            Low</option>
                                        <option value="High" {% if task and task.priority=='High' %}selected{% endif %}>
                                            High</option>
                                        <option value="Critical" {% if task and task.priority=='Critical' %}selected{%
                                            endif %}>Critical</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" name="description"
                                rows="3">{{ task.description if task else '' }}</textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="status" class="form-label">Status</label>
                                    <select class="form-select" id="status" name="status">
                                        <option value="Not Started" {% if task and task.status=='Not Started'
                                            %}selected{% endif %}>Not Started</option>
                                        <option value="In Progress" {% if task and task.status=='In Progress'
                                            %}selected{% endif %}>In Progress</option>
                                        <option value="Completed" {% if task and task.status=='Completed' %}selected{%
                                            endif %}>Completed</option>
                                        <option value="On Hold" {% if task and task.status=='On Hold' %}selected{% endif
                                            %}>On Hold</option>
                                        <option value="Cancelled" {% if task and task.status=='Cancelled' %}selected{%
                                            endif %}>Cancelled</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="assigned_to" class="form-label">Assign To</label>
                                    <select class="form-select" id="assigned_to" name="assigned_to">
                                        <option value="">Unassigned</option>
                                        {% for user in users %}
                                        <option value="{{ user.id }}" {% if task and task.assigned_to==user.id
                                            %}selected{% endif %}>
                                            {{ user.username }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="estimated_hours" class="form-label">Estimated Hours</label>
                                    <input type="number" step="0.5" class="form-control" id="estimated_hours"
                                        name="estimated_hours" placeholder="e.g., 8.5"
                                        value="{{ task.estimated_hours if task and task.estimated_hours else '' }}">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="due_date" class="form-label">Due Date</label>
                                    <input type="date" class="form-control" id="due_date" name="due_date"
                                        value="{{ task.due_date.strftime('%Y-%m-%d') if task and task.due_date else '' }}">
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="reset" class="btn btn-outline-secondary me-md-2">Reset</button>
                            <button type="submit" class="btn btn-primary">
                                {% if task %}Update{% else %}Create{% endif %} Task
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}